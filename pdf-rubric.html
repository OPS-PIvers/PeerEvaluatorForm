<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Observation Report</title>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #fff;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            padding-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }
        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 10px;
        }
        .header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        .domain-section {
            border-bottom: 3px solid #e2e8f0;
            margin-top: 20px;
            page-break-inside: avoid;
        }
        .domain-header {
            background: linear-gradient(135deg, #7c9ac5, #5a82b8);
            color: white;
            padding: 15px 20px;
            font-size: 1.1rem;
            font-weight: 600;
        }
        .performance-levels-header {
            border-bottom: 2px solid #e2e8f0;
        }
        .performance-levels {
            display: grid;
            grid-template-columns: 200px 1fr 1fr 1fr 1fr;
        }
        .performance-levels-content {
            display: grid;
            grid-template-columns: 200px 1fr 1fr 1fr 1fr;
        }
        .level-header {
            background: #e2e8f0;
            padding: 12px;
            font-weight: 600;
            text-align: center;
            border-bottom: 1px solid #cbd5e0;
            color: #4a5568;
            font-size: 0.9rem;
        }
        .level-content {
            padding: 20px;
            border-right: 1px solid #e2e8f0;
            border-bottom: 1px solid #e2e8f0;
            background: white;
            color: #4a5568;
            font-size: 0.9rem;
        }
        .level-content.selected {
            background-color: #dbeafe;
            border-color: #3b82f6;
            color: #1e40af;
            font-weight: 600;
            border-left: 3px solid #3b82f6;
        }
        .row-label {
            background: #64748b;
            padding: 20px;
            font-weight: 600;
            color: white;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        .media-links-container {
            padding: 10px 20px;
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
        }
        .media-link-item a {
            color: #3182ce;
            text-decoration: none;
        }
    </style>
</head>
<%
// Remove the duplicated escapeHtml function - now using the shared version from Utils.js
%>
<body>
    <div class="container">
        <div class="header">
            <h1>Observation Report for <?= escapeHtml(data.observation.observedName) ?></h1>
            <p>Role: <?= escapeHtml(data.observation.observedRole) ?> | Year: <?= escapeHtml(data.observation.observedYear || 'N/A') ?></p>
            <p>Observer: <?= escapeHtml(data.observation.observerEmail) ?></p>
            <p>Finalized on: <?= data.observation.finalizedAt ? new Date(data.observation.finalizedAt).toLocaleString() : 'N/A' ?></p>
        </div>

        <? for (var domainIdx = 0; domainIdx < data.rubricData.domains.length; domainIdx++) {
            var domain = data.rubricData.domains[domainIdx];
            var domainHasContent = domain.components.some(c => data.observation.observationData[c.componentId]);
        ?>
            <? if (domainHasContent) { ?>
            <div class="domain-section">
                <div class="domain-header">
                    <?= escapeHtml(domain.name) ?>
                </div>

                <div class="performance-levels-header">
                    <div class="performance-levels">
                        <div class="level-header"></div>
                        <div class="level-header">Developing</div>
                        <div class="level-header">Basic</div>
                        <div class="level-header">Proficient</div>
                        <div class="level-header">Distinguished</div>
                    </div>
                </div>

                <? for (var i = 0; i < domain.components.length; i++) {
                    var component = domain.components[i];
                    var proficiency = data.observation.observationData[component.componentId];
                ?>
                    <? if (proficiency) { ?>
                    <div class="component-section">
                        <div class="performance-levels-content">
                            <div class="row-label">
                                <?= escapeHtml(component.title) ?>
                            </div>
                            <div class="level-content <?= proficiency === 'developing' ? 'selected' : '' ?>">
                                <?= escapeHtml(component.developing) ?>
                            </div>
                            <div class="level-content <?= proficiency === 'basic' ? 'selected' : '' ?>">
                                <?= escapeHtml(component.basic) ?>
                            </div>
                            <div class="level-content <?= proficiency === 'proficient' ? 'selected' : '' ?>">
                                <?= escapeHtml(component.proficient) ?>
                            </div>
                            <div class="level-content <?= proficiency === 'distinguished' ? 'selected' : '' ?>">
                                <?= escapeHtml(component.distinguished) ?>
                            </div>
                        </div>

                        <? var evidence = data.observation.evidenceLinks[component.componentId]; ?>
                        <? if (evidence && evidence.length > 0) { ?>
                        <div class="media-links-container">
                            <strong>Evidence:</strong>
                            <ul>
                            <? for (var j = 0; j < evidence.length; j++) { ?>
                                <li class="media-link-item">
                                    <a href="<?= escapeHtml(evidence[j].url) ?>" target="_blank"><?= escapeHtml(evidence[j].name) ?></a>
                                </li>
                            <? } ?>
                            </ul>
                        </div>
                        <? } ?>
                    </div>
                    <? } ?>
                <? } ?>
            </div>
            <? } ?>
        <? } ?>
    </div>
</body>
</html>
