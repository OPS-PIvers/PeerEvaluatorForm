<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Observation Report</title>
<style>
:root {
    --color-white: white;
    --color-text-default: #333;
    --color-bg-body: #f5f5f5;

    /* Greens for toggle button and assignments */
    --color-green-base: #10b981;
    --color-green-dark: #059669;
    --color-green-darker: #047857;
    --color-green-light-bg: #f0fdf4;

    /* Ambers for toggle button (assigned mode) and active filters */
    --color-amber-base: #f59e0b;
    --color-amber-dark: #d97706;
    --color-amber-darker: #b45309;
    --color-amber-light-bg: #fef3c7;
    --color-amber-text-dark: #92400e;

    /* Blues for filter status and select focus */
    --color-blue-base: #3b82f6;
    --color-blue-light-bg: #dbeafe;
    --color-blue-text-dark: #1e40af;
    --color-blue-focus-shadow: rgba(59, 130, 246, 0.1);

    /* Grays for various UI elements */
    --color-gray-text: #4a5568;
    --color-gray-text-light: #374151;
    --color-gray-border-light: #d1d5db;
    --color-gray-border-medium: #e2e8f0;
    --color-gray-bg-light: #f8fafc;
    --color-gray-bg-medium: #6b7280;
    --color-gray-bg-dark: #4b5563;
    --color-gray-component-not-assigned-border: #e5e7eb;
    --color-gray-assignment-indicator-not-assigned-bg: #e5e7eb;
    --color-text-deemphasized: #718096;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    line-height: 1.6;
    color: var(--color-text-default);
    background-color: var(--color-white); /* White background for PDF */
    padding: 20px;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.header {
    background: linear-gradient(135deg, #4a5568, #2d3748);
    color: white;
    padding: 20px;
    text-align: center;
}

.header h1 {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 10px;
}

.header p {
    font-size: 0.9rem;
    opacity: 0.9;
}

.domain-section {
    border-bottom: 3px solid #e2e8f0;
    page-break-inside: avoid;
}

.domain-header {
    background: linear-gradient(135deg, #7c9ac5, #5a82b8);
    color: white;
    padding: 15px 20px;
    font-size: 1.1rem;
    font-weight: 600;
}

.component-section {
    border-bottom: 1px solid var(--color-gray-border-medium);
}

.performance-levels-header {
    background: white;
    border-bottom: 2px solid #e2e8f0;
}

.performance-levels {
    display: grid;
    grid-template-columns: 200px 1fr 1fr 1fr 1fr;
    min-height: 50px;
}

.performance-levels-content {
    display: grid;
    grid-template-columns: 200px 1fr 1fr 1fr 1fr;
    min-height: 120px;
}

.level-header {
    background: #e2e8f0;
    padding: 12px;
    font-weight: 600;
    text-align: center;
    border-bottom: 1px solid #cbd5e0;
    color: #4a5568;
    font-size: 0.9rem;
}

.level-content {
    padding: 20px;
    border-right: 1px solid #e2e8f0;
    border-bottom: 1px solid #e2e8f0;
    background: white;
    color: #4a5568;
    font-size: 0.9rem;
}

.level-content:last-child {
    border-right: none;
}

.level-content.selected {
    background-color: var(--color-blue-light-bg);
    border-color: var(--color-blue-base);
    color: var(--color-blue-text-dark);
    font-weight: 600;
    border-left: 3px solid var(--color-blue-base);
}

.row-label {
    background: #64748b;
    padding: 20px;
    font-weight: 600;
    color: white;
    border-bottom: 1px solid #e2e8f0;
    display: flex;
    align-items: center;
    font-size: 0.9rem;
}

.media-links-container {
    padding: 10px 20px;
    background: #f8fafc;
    border-top: 1px solid #e2e8f0;
}

.media-link-item a {
    color: #3182ce;
    text-decoration: none;
}
</style>
</head>
<?
// Remove the duplicated escapeHtml function - now using the shared version from Utils.js
?>
<body>
    <div class="container">
        <div class="header">
            <h1>Observation Report for <?= escapeHtml(data.observation.observedName) ?></h1>
            <p>Role: <?= escapeHtml(data.observation.observedRole) ?> | Year: <?= escapeHtml(data.observation.observedYear || 'N/A') ?></p>
            <p>Observer: <?= escapeHtml(data.observation.observerEmail) ?></p>
            <p>Finalized on: <?= data.observation.finalizedAt ? new Date(data.observation.finalizedAt).toLocaleString() : 'N/A' ?></p>
        </div>

        <? for (var domainIdx = 0; domainIdx < data.rubricData.domains.length; domainIdx++) {
            var domain = data.rubricData.domains[domainIdx];
            var domainHasContent = domain.components.some(c => data.observation.observationData[c.componentId]);
        ?>
            <? if (domainHasContent) { ?>
            <div class="domain-section">
                <div class="domain-header">
                    <?= escapeHtml(domain.name) ?>
                </div>

                <div class="performance-levels-header">
                    <div class="performance-levels">
                        <div class="level-header"></div>
                        <div class="level-header">Developing</div>
                        <div class="level-header">Basic</div>
                        <div class="level-header">Proficient</div>
                        <div class="level-header">Distinguished</div>
                    </div>
                </div>

                <? for (var i = 0; i < domain.components.length; i++) {
                    var component = domain.components[i];
                    var proficiency = data.observation.observationData[component.componentId];
                ?>
                    <? if (proficiency) { ?>
                    <div class="component-section">
                        <div class="performance-levels-content">
                            <div class="row-label">
                                <?= escapeHtml(component.title) ?>
                            </div>
                            <div class="level-content <?= proficiency === 'developing' ? 'selected' : '' ?>">
                                <?= escapeHtml(component.developing) ?>
                            </div>
                            <div class="level-content <?= proficiency === 'basic' ? 'selected' : '' ?>">
                                <?= escapeHtml(component.basic) ?>
                            </div>
                            <div class="level-content <?= proficiency === 'proficient' ? 'selected' : '' ?>">
                                <?= escapeHtml(component.proficient) ?>
                            </div>
                            <div class="level-content <?= proficiency === 'distinguished' ? 'selected' : '' ?>">
                                <?= escapeHtml(component.distinguished) ?>
                            </div>
                        </div>

                        <? var evidence = data.observation.evidenceLinks[component.componentId]; ?>
                        <? if (evidence && evidence.length > 0) { ?>
                        <div class="media-links-container">
                            <strong>Evidence:</strong>
                            <ul>
                            <? for (var j = 0; j < evidence.length; j++) { ?>
                                <li class="media-link-item">
                                    <a href="<?= escapeHtml(evidence[j].url) ?>" target="_blank"><?= escapeHtml(evidence[j].name) ?></a>
                                </li>
                            <? } ?>
                            </ul>
                        </div>
                        <? } ?>
                    </div>
                    <? } ?>
                <? } ?>
            </div>
            <? } ?>
        <? } ?>
    </div>
</body>
</html>
